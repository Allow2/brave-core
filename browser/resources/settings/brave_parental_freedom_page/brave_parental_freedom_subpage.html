<style include="cr-shared-style settings-shared md-select">
  :host {
    display: block;
  }

  .allow2-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 24px;
    padding: 16px 0;
  }

  .allow2-logo {
    width: 64px;
    height: 64px;
  }

  .allow2-title {
    font-size: 24px;
    font-weight: 600;
    color: var(--cr-primary-text-color);
  }

  .allow2-subtitle {
    font-size: 14px;
    color: var(--cr-secondary-text-color);
    margin-top: 4px;
  }

  .page-header {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 24px;
    background: var(--cr-card-background-color);
    border-radius: 12px;
    margin-bottom: 24px;
  }

  .page-header-icon {
    width: 72px;
    height: 72px;
    flex-shrink: 0;
  }

  .page-header-text {
    flex: 1;
  }

  .page-header-title {
    font-size: 28px;
    font-weight: 600;
    color: var(--cr-primary-text-color);
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .page-header-description {
    font-size: 14px;
    color: var(--cr-secondary-text-color);
    margin-top: 8px;
    line-height: 1.5;
  }

  .page-header-action {
    flex-shrink: 0;
    align-self: center;
  }

  .header-pair-button {
    --cr-button-height: 40px;
    font-weight: 500;
  }

  .benefits-section {
    padding: 24px;
    background: var(--cr-card-background-color);
    border-radius: 12px;
    margin-bottom: 24px;
  }

  .benefits-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 16px;
    color: var(--cr-primary-text-color);
  }

  .benefits-list {
    margin: 0;
    padding: 0 0 0 20px;
  }

  .benefits-list li {
    margin-bottom: 12px;
    color: var(--cr-secondary-text-color);
    line-height: 1.5;
  }

  .action-section {
    display: flex;
    flex-direction: column;
    gap: 16px;
    align-items: stretch;
    padding: 0 24px 24px 24px;
    margin-top: 8px;
    text-align: center;
  }

  .primary-pair-button {
    --cr-button-height: 52px;
    font-size: 16px;
    font-weight: 600;
    width: 100%;
  }

  .learn-more-link {
    color: var(--cr-link-color);
    text-decoration: none;
    font-size: 14px;
  }

  .learn-more-link:hover {
    text-decoration: underline;
  }

  .paired-section {
    padding: 24px;
    background: var(--cr-card-background-color);
    border-radius: 12px;
  }

  .paired-status {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
  }

  .status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: #4caf50;
  }

  .status-text {
    font-size: 16px;
    font-weight: 500;
    color: var(--cr-primary-text-color);
  }

  .paired-message {
    color: var(--cr-secondary-text-color);
    line-height: 1.6;
    margin-bottom: 16px;
  }

  .paired-links {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
  }

  /* Pairing dialog styles */
  .pairing-dialog {
    padding: 24px;
    background: var(--cr-card-background-color);
    border-radius: 12px;
    text-align: center;
  }

  .qr-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 24px;
    margin: 16px 0;
  }

  .pin-code {
    font-size: 28px;
    font-weight: bold;
    letter-spacing: 8px;
    font-family: monospace;
    margin: 16px 0;
    padding: 12px 24px;
    background: var(--cr-active-background-color);
    border-radius: 8px;
  }

  .pairing-instructions {
    color: var(--cr-secondary-text-color);
    font-size: 14px;
    margin: 8px 0;
  }

  .button-row {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 16px;
  }
</style>

<settings-section
  page-title="Allow2 Parental Freedom">

  <!-- Page Header with Prominent Hand Icon (hidden during pairing) -->
  <template is="dom-if" if="[[!pairingSession_]]">
    <div class="page-header">
      <img src="chrome://settings/brave_parental_freedom_page/allow2_hand.svg"
           alt="Allow2" class="page-header-icon">
      <div class="page-header-text">
        <div class="page-header-title">
          Allow2 Parental Freedom
        </div>
        <div class="page-header-description">
          Cross-platform parental controls that empower families with trust-based screen time management.
        </div>
      </div>
      <template is="dom-if" if="[[!isPaired_]]">
        <div class="page-header-action">
          <cr-button class="header-pair-button action-button" on-click="onStartPairing_">
            Pair with Allow2
          </cr-button>
        </div>
      </template>
    </div>

    <!-- Embedded Ad/Promo Block from Allow2 (hidden during pairing) -->
    <iframe id="allow2PromoFrame"
            src="https://app.allow2.com/embed/brave-promo.html"
            style="width: 100%; border: none; border-radius: 12px; margin-bottom: 24px; min-height: 120px;"
            sandbox="allow-scripts allow-same-origin"
            loading="lazy"></iframe>
  </template>

  <!-- Not Paired State: Show Benefits and Pair Button -->
  <template is="dom-if" if="[[!isPaired_]]">
    <template is="dom-if" if="[[!pairingSession_]]">
      <div class="benefits-section">
        <div class="benefits-title">Empower Your Family with Allow2</div>
        <ul class="benefits-list">
          <li><strong>Cross-platform control</strong> - Works on all devices: Windows, macOS, Linux, iOS, and Android</li>
          <li><strong>Real-time management</strong> - Approve or deny time requests instantly from your phone</li>
          <li><strong>Shared device support</strong> - Each family member gets their own profile with PIN protection</li>
          <li><strong>Trust-based approach</strong> - Children learn time management, not just restrictions</li>
          <li><strong>No surveillance</strong> - Transparent controls without hidden tracking</li>
        </ul>
      </div>

      <div class="action-section">
        <a href="https://www.allow2.com" target="_blank" rel="noopener" class="learn-more-link">
          Learn more about Allow2 Parental Freedom →
        </a>
        <cr-button class="primary-pair-button action-button" on-click="onStartPairing_">
          Pair with Allow2
        </cr-button>
      </div>
    </template>

    <!-- Pairing in Progress -->
    <template is="dom-if" if="[[pairingSession_]]">
      <div class="pairing-dialog">
        <div class="benefits-title">Pair This Device</div>

        <div class="benefits-section" style="text-align: left; margin-bottom: 24px;">
          <ul class="benefits-list">
            <li><strong>Easy setup</strong> - Pair in seconds using your phone or the web</li>
            <li><strong>Instant control</strong> - Manage all devices from the Allow2 app</li>
            <li><strong>Secure</strong> - PIN-protected, no passwords stored on device</li>
          </ul>
        </div>

        <div class="pairing-instructions">
          <strong>Option 1:</strong> Scan with the Allow2 app on your phone
        </div>

        <div class="qr-container">
          <img id="qrCodeImage" alt="QR Code for pairing" style="max-width: 200px;">
          <div class="pairing-instructions" style="margin-top: 16px;">Or enter this PIN in the app:</div>
          <div class="pin-code">[[pairingSession_.pinCode]]</div>
        </div>

        <div class="pairing-instructions" style="margin-top: 24px;">
          <strong>Option 2:</strong> Pair using your web browser
        </div>
        <div class="pairing-instructions">
          <a id="webPairingLink" href$="[[getWebPairingUrl_(pairingSession_)]]" target="_blank" rel="noopener" class="learn-more-link">
            Open Allow2 Web Portal to pair →
          </a>
        </div>

        <div class="pairing-instructions" style="margin-top: 24px; font-style: italic;">
          Waiting for parent approval...
        </div>

        <div class="button-row">
          <cr-button on-click="onCancelPairing_">
            Cancel
          </cr-button>
        </div>
      </div>
    </template>
  </template>

  <!-- Paired State: Show Status and Management Info -->
  <template is="dom-if" if="[[isPaired_]]">
    <div class="paired-section">
      <div class="paired-status">
        <div class="status-indicator"></div>
        <span class="status-text">Paired with Allow2</span>
      </div>

      <div class="paired-message">
        This device is connected to your Allow2 family account. All parental controls,
        time limits, and restrictions are managed through the Allow2 platform and mobile apps.
      </div>

      <div class="paired-links">
        <a href="https://app.allow2.com" target="_blank" rel="noopener" class="learn-more-link">
          Manage Settings in Allow2 →
        </a>
        <a href="https://www.allow2.com/apps" target="_blank" rel="noopener" class="learn-more-link">
          Get the Allow2 App →
        </a>
      </div>
    </div>
  </template>

</settings-section>
